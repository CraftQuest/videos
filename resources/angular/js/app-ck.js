"use strict";var videos=angular.module("videos",[]).value("$anchorScroll",angular.noop).config(["$routeProvider",function(e,t){var n=Craft.getResourceUrl("videos/angular/partials/empty.html");e.when("/",{templateUrl:n,controller:ServicesListCtrl}).when("/:serviceKey",{templateUrl:n,controller:ServicesListCtrl}).when("/:serviceKey/:methodName",{templateUrl:n,controller:ServicesListCtrl}).when("/:serviceKey/:methodName/:playlistId",{templateUrl:n,controller:ServicesListCtrl}).otherwise({redirectTo:"/"})}]);videos.factory("VideosService",function(e,t){var n={searchQuery:"",currentService:!1,currentMethod:!1,services:!1,loader:{on:function(){console.log("loader on");$(".dkv-main .dkv-toolbar .dkv-spinner").removeClass("dkv-hidden")},off:function(){console.log("loader off");$(".dkv-main .dkv-toolbar .dkv-spinner").addClass("dkv-hidden")}},videoMore:{on:function(){$(".dkv-video-more").css("display","block")},off:function(){$(".dkv-video-more").css("display","none")}},refreshServicesTokens:function(){console.log("refreshing tokens");t({method:"POST",url:DkvEndpoint.url("refreshServicesTokens")}).success(function(e,t,n,r){console.log(e)}).error(function(e,t,n,r){console.log("error",e,t,n,r)})}};return n});videos.run(function(e,t,n,r,i,s){function u(n,r,i){var s={method:"search",service:n.serviceKey,searchQuery:r,page:1,perPage:Dukt_videos.pagination_per_page};i.loader.on();t({method:"POST",url:DkvEndpoint.url("search",s),cache:!0}).success(function(t,n,r,s){e.videos=t;dkvideos.scroll.init();t.length<Dukt_videos.pagination_per_page?i.videoMore.off():i.videoMore.on();i.loader.off()}).error(function(e,t,n,r){console.log("error",e,t,n,r)})}console.log("run",videos);s.refreshServicesTokens();t({method:"POST",url:DkvEndpoint.url("services")}).success(function(r,o,u,a){console.log("services success");$(".dkv-modal").removeClass("dkv-loading");e.services=r;console.log("number of services detected : ",e.services.length);if(e.services.length==0){e.errorMessage="Set up a video service";$(".dkv-getStarted").css("display","block");$(".dkv-modal").css("display","none");return!1}setInterval(function(){console.log("check and refresh services tokens");s.refreshServicesTokens()},18e4);$.each(r,function(n,r){t({method:"POST",url:DkvEndpoint.url("playlists",{service:r.name})}).success(function(t,r,i,s){e.services[n].playlists=t}).error(function(e,t,n,r){console.log("error",e,t,n,r)})});$.each(e.services,function(t,n){if(i.serviceKey==t||typeof i.serviceKey=="undefined"){e.currentService=n;return!1}});console.log("currentService",e.currentService);console.log("$routeParams.serviceKey",i.serviceKey);e.serviceKey=e.currentService.name;if(n.path()=="/"||n.path()==""){console.log("redirect",e.serviceKey+"/uploads");n.path(e.serviceKey+"/uploads")}}).error(function(e,t,n,r){console.log("error",e,t,n,r)});e.serviceChange=function(){console.log("serviceChange",this.serviceKey);e.currentService=e.services[this.serviceKey];var t=i.methodName;t=="playlist"&&(t="favorites");e.search();n.path($(".dkv-sidebar select").val()+"/"+t)};e.getClass=function(e){var t=new RegExp("/.*/"+e),r=n.path().match(t);return r?"active":""};var o=!1;e.search=function(){typeof this.searchQuery!="undefined"&&(s.searchQuery=this.searchQuery);var e=s.searchQuery,t=new RegExp("/.*/search"),r=n.path().match(t);r||n.path(i.serviceKey+"/search");if(e!=""){clearTimeout(o);o=setTimeout(function(){console.log("search",i.serviceKey,e);u(i,e,s)},500)}};$(document).on("keypress",".dkv-search input",function(t){t.keyCode=="13"&&e.search()})});