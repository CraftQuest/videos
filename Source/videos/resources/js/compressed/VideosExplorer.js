"undefined"==typeof Videos&&(Videos={}),Videos.Explorer=Garnish.Base.extend({previewModal:null,previewInject:null,searchTimeout:null,init:function(e){this.$explorer=e,this.$nav=$("nav",this.$explorer),this.$gatewaysSelect=$(".gateways select",this.$explorer),this.$inject=$(".inject",this.$explorer),this.$error=$(".error",this.$explorer),this.$spinner=$(".spinner",this.$explorer),this.$search=$(".search",this.$explorer),this.$links=$("a",this.$nav),this.addListener(this.$links,"click",$.proxy(function(e){this.$links.filter(".sel").removeClass("sel"),$(e.currentTarget).addClass("sel"),gateway=$(e.currentTarget).data("gateway"),method=$(e.currentTarget).data("method"),options=$(e.currentTarget).data("options"),this.getVideos(gateway,method,options),e.preventDefault()})),this.addListener(this.$search,"textchange",$.proxy(function(e){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout($.proxy(this,"search",e),500)},this)),this.addListener(this.$search,"keypress",function(e){e.keyCode==Garnish.RETURN_KEY&&(e.preventDefault(),this.search(e))}),$("div:not(.hidden) a:first",this.$nav).trigger("click")},search:function(e){q=$(e.currentTarget).val(),q.length>0?(gateway=this.$gatewaysSelect.val(),method="search",options={q:q},this.getVideos(gateway,method,options)):this.$inject.html("")},showPreview:function(e){var t=$(e.currentTarget).data("gateway"),i=$(e.currentTarget).data("id");if(this.previewModal)this.previewModal.show();else{var s=$('<form id="videos-preview-form" class="modal fitted"/>').appendTo(Garnish.$bod),r=$('<div class="body"></div>').appendTo(s);this.$previewInject=$('<div class="inject"/>').appendTo(r);{var a=$('<div class="buttons right"/>').appendTo(r),o=$('<div class="btn">'+Craft.t("Cancel")+"</div>").appendTo(a);$('<input type="submit" class="btn submit" value="'+Craft.t("Continue")+'" />').appendTo(a)}this.previewModal=new Garnish.Modal(s,{visible:!1,resizable:!0,onHide:$.proxy(function(){this.$previewInject.html("")},this)}),this.addListener(o,"click",function(){this.previewModal.hide()})}var n={gateway:t,videoId:i};Craft.postActionRequest("videos/preview",n,$.proxy(function(e,t){this.$previewInject.html(e.html),this.previewModal.updateSizeAndPosition()},this))},getVideos:function(e,t,i){data={gateway:e,method:t,options:i},console.log("Videos.Explorer.getVideos() request",data),this.$error.addClass("hidden"),this.$spinner.removeClass("hidden"),Craft.postActionRequest("videos/getVideos",data,$.proxy(function(e,t){this.$spinner.addClass("hidden"),this.$inject.html(""),this.$error.html(""),"success"==t&&("undefined"==typeof e.error?this.$inject.html(e.html):(this.$error.html(e.error),this.$error.removeClass("hidden")),this.$videos=$(".video",this.$explorer),this.$playBtns=$(".play",this.$videos),this.addListener(this.$playBtns,"click","showPreview"),console.log("Videos.Explorer.getVideos() response",e))},this))}});