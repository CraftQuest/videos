function KoManager(){var e=this;e.gateways=ko.observableArray(),Dukt.postActionRequest("videos/getGatewaysWithSections",{},$.proxy(function(n,a){n&&"success"==a?n.hasOwnProperty("error")?$manager.error(n.error):(e.gateways(n.gateways),0==e.gateways().length&&($(".videos-no-gateway",this.$container).removeClass("hidden"),$(".videos-gateways-loading",this.$container).addClass("hidden")),$(".videos-sidebar .dk-section:first-child li:first-child",$manager.$container).trigger("click")):$manager.error("Couldn't get gateways.")},this)),ko.bindingHandlers.updateVideos={update:function(e){var n=$(".videos-main .dk-middle",$manager.$container),a=$(".dk-no-videos",n);Dukt.Utils.positionCenter(a,n),setTimeout(function(){Dukt.Utils.positionCenter(a,n)},1)}},e.videos=ko.observable(),e.selectedGateway=ko.observable(),e.selectedSectionItem=ko.observable(),e.selectedVideoIndex=ko.observable(),e.goToSectionItem=function(n){$manager.spinner("on"),e.resetVideosRequest();var a={url:n.url};e.getVideos(a),e.selectedSectionItem(n.url)},e.searchQuery="",e.previousSearchQuery="",e.searchTimeout=!1,e.resetVideosRequest=function(){e.lastRequestData={},e.pagination={page:1,nextPage:null,nextPageToken:null}},e.getVideos=function(n){var a=!0;"undefined"==typeof n?(a=!1,n=e.lastRequestData):e.lastRequestData=n,"undefined"==typeof n.options&&(n.options={}),null!=e.pagination.nextPage&&(n.options.nextPage=e.pagination.nextPage),null!=e.pagination.nextPageToken&&(n.options.nextPageToken=e.pagination.nextPageToken),$manager.spinner("on"),$manager.getVideosErrorReset(),$manager.more("hide"),Dukt.postActionRequest("videos/getVideosFromUrl",n,$.proxy(function(n,o){if($manager.spinner("off"),n&&"success"==o&&!n.hasOwnProperty("error")&&"undefined"!=typeof n.videos){n.hasOwnProperty("nextPage")&&(e.pagination.nextPage=n.nextPage),n.hasOwnProperty("nextPageToken")&&(e.pagination.nextPageToken=n.nextPageToken),n.hasOwnProperty("more")&&1==n.more&&$manager.more("show"),$(".dk-videos",$manager.$container).removeClass("hidden"),a?(e.selectedVideoIndex(null),$(".submit",$manager.$container).addClass("disabled"),$(".videos-main .dk-middle",$manager.$container).get(0).scrollTop=0,e.videos(n.videos)):e.videos(e.videos().concat(n.videos)),0==e.videos().length?($(".dk-no-videos",$manager.$container).removeClass("hidden"),$manager.more("hide")):$(".dk-no-videos",$manager.$container).addClass("hidden");var r=$(".videos-main .dk-middle",$manager.$container),t=$(".dk-no-videos",r);Dukt.Utils.positionCenter(t,r)}else n&&"undefined"!=typeof n.videos?n.hasOwnProperty("error")&&(error=n.error):error="Couldn't get videos.",a?$manager.getVideosError(error):($(".dk-videos",$manager.$container).addClass("hidden"),$manager.getVideosError(error,!0))},this))},e.more=function(){e.getVideos()},e.doSearch=function(n){"undefined"!=typeof n&&n&&(e.previousSearchQuery=""),""==e.searchQuery?e.previousSearchQuery=e.searchQuery:e.previousSearchQuery!=e.searchQuery&&(e.previousSearchQuery=e.searchQuery,clearTimeout(e.searchTimeout),$manager.spinner("on"),e.searchTimeout=setTimeout(function(){var n={url:e.selectedGateway()+"/search",options:{q:e.searchQuery}};e.getVideos(n)},800))},e.cancel=function(){$manager.close()},e.back=function(){$manager.back()},e.play=function(e){$manager.play(e)},e.submit=function(n,a,o,r){if($target=$(a.target),!$target.hasClass("disabled")){var t=e.selectedVideoIndex(),i=e.videos(),s=i[t],d=$manager.$field;d.$input.val(s.url),d.lookupVideo(),$manager.close()}},e.selectVideo=function(n,a){e.selectedVideoIndex(n),$(".submit",$manager.$container).removeClass("disabled")}}