"undefined"==typeof Videos&&(Videos={}),Videos.Field=Garnish.Base.extend({$input:null,$spinner:null,$preview:null,$player:null,$explorer:null,explorer:null,playerModal:null,explorerModal:null,lookupVideoTimeout:null,init:function(e){this.$input=$("#"+e),this.$container=this.$input.parents(".dkv-video"),this.$play=$(".play",this.$container),this.$spinner=$(".dk-spinner",this.$container),this.$preview=$(".dkv-preview-inject",this.$container),this.$addBtn=$(".dk-add, .dk-edit",this.$container),this.$removeBtn=$(".delete",this.$container),this.addListener(this.$input,"textchange","lookupVideo"),this.addListener(this.$play,"click","playVideo"),this.addListener(this.$addBtn,"click","openExplorer"),this.addListener(this.$removeBtn,"click",$.proxy(function(e){this.$input.val(""),this.lookupVideo(),e.preventDefault()}))},openExplorer:function(e){this.explorerModal?this.explorerModal.show():(this.$explorer=$('<div class="explorer modal"></div>').appendTo(Garnish.$bod),this.explorerModal=new Garnish.Modal(this.$explorer,{visible:!1,resizable:!0}),Craft.postActionRequest("videos/explorer",{},$.proxy(function(e,i){this.$explorer.html(e.html),this.explorer=new Videos.Explorer(this.$explorer),this.explorerModal.updateSizeAndPosition(),Craft.initUiElements()},this)))},playVideo:function(e){var i=$(e.currentTarget).data("gateway"),t=$(e.currentTarget).data("id");this.playerModal?this.playerModal.show():(this.$player=$('<div class="player modal" />').appendTo(Garnish.$bod),this.playerModal=new Garnish.Modal(this.$player,{visible:!1,resizable:!0,onHide:$.proxy(function(){this.$player.html("")},this)}));var r={gateway:i,videoId:t};Craft.postActionRequest("videos/player",r,$.proxy(function(e,i){this.$player.html(e.html),this.playerModal.updateSizeAndPosition()},this))},lookupVideo:function(){var e=this.$input.val();e?(this.$spinner.removeClass("hidden"),$(".dk-error",this.$container).addClass("hidden"),Craft.postActionRequest("videos/lookupVideo",{url:e},$.proxy(function(e,i){this.$spinner.addClass("hidden"),e&&"success"==i?e.hasOwnProperty("error")?($(".dk-error",this.$container).html(e.error),$(".dk-error",this.$container).removeClass("hidden"),this.$preview.hide()):(this.$preview.show(),this.$preview.html(e.preview)):this.$preview.hide()},this))):this.$preview.hide()}}),$(document).ready(function(){"undefined"!=typeof Matrix&&Matrix.bind("dukt_videos","display",function(e){var i=$(".dkv-input",this);if(i.length){var t=e.field.id+"["+e.row.id+"]["+e.col.id+"]",r=t.replace(/[^\w\-]+/g,"_");i.attr("id",r),e.videosField=new Videos.Field(r)}})});