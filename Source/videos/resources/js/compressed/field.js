VideoField=Dukt.Base.extend({$input:null,$spinner:null,$preview:null,lookupVideoTimeout:null,init:function(i){this.$input=$("#"+i),this.$container=this.$input.parents(".dkv-video"),this.$spinner=$(".dk-spinner",this.$input.parents(".dkv-video")),this.$preview=$(".dkv-preview-inject",this.$input.parents(".dkv-video")),this.addListener(this.$input,"textchange","lookupVideo");var e=this;this.$container.on("click",".dkv-image",function(i){e.playVideo(),i.preventDefault()}),$(".dk-add, .dk-edit",this.$container).on("click",function(i){$manager.open(e),i.preventDefault()}),this.$container.on("click",".dk-remove",function(i){e.$input.val(""),e.lookupVideo(),i.preventDefault()})},playVideo:function(){$player.play(this.$input.val())},lookupVideo:function(){var i=this.$input.val();i?(this.$spinner.removeClass("hidden"),$(".dk-error",this.$container).addClass("hidden"),Dukt.postActionRequest("videos/lookupVideo",{url:i},$.proxy(function(i,e){this.$spinner.addClass("hidden"),i&&"success"==e?i.hasOwnProperty("error")?($(".dk-error",this.$container).html(i.error),$(".dk-error",this.$container).removeClass("hidden"),this.$preview.hide()):(this.$preview.show(),this.$preview.html(i.preview)):this.$preview.hide()},this))):this.$preview.hide()}});var Player=Modal.extend({init:function(){this.base()},play:function(i){var e={url:i};e[csrfTokenName]=csrfTokenValue,$.post(Dukt.getActionUrl("videos/player"),e,$.proxy(function(i,e,t){"success"==e&&(this.$inject.html(i),this.open())},this))},onBeforeOpen:function(){$("iframe",this.$container).height(this.$container.height())},onBeforeClose:function(){this.$inject.html("")}}),$player=new Player;$(document).ready(function(){"undefined"!=typeof Matrix&&Matrix.bind("dukt_videos","display",function(i){var e=$(".dkv-input",this);if(e.length){var t=i.field.id+"["+i.row.id+"]["+i.col.id+"]",n=t.replace(/[^\w\-]+/g,"_");e.attr("id",n),i.videosField=new VideoField(n)}})});