/**
 * Knockout Manager
 */function KoManager(){var e=this;e.gateways=ko.observableArray();Dukt.postActionRequest("videos/getGatewaysWithSections",{},$.proxy(function(t,n){if(t&&n=="success")if(!t.hasOwnProperty("error")){e.gateways(t.gateways);if(e.gateways().length==0){$(".videos-no-gateway",this.$container).removeClass("hidden");$(".videos-gateways-loading",this.$container).addClass("hidden")}$(".videos-sidebar .dk-section:first-child li:first-child",$manager.$container).trigger("click")}else $manager.error(t.error);else $manager.error("Couldn't get gateways.")},this));ko.bindingHandlers.updateVideos={update:function(e){var t=$(".videos-main .dk-middle",$manager.$container),n=$(".dk-no-videos",t);Dukt.Utils.positionCenter(n,t);setTimeout(function(){Dukt.Utils.positionCenter(n,t)},1)}};e.videos=ko.observable();e.selectedGateway=ko.observable();e.selectedSectionItem=ko.observable();e.selectedVideoIndex=ko.observable();e.goToSectionItem=function(t){$manager.spinner("on");e.resetVideosRequest();var n={url:t.url};e.getVideos(n);e.selectedSectionItem(t.url)};e.searchQuery="";e.previousSearchQuery="";e.searchTimeout=!1;e.resetVideosRequest=function(){e.lastRequestData={};e.pagination={page:1,nextPage:null,nextPageToken:null}};e.getVideos=function(t){var n=!0;if(typeof t=="undefined"){n=!1;t=e.lastRequestData}else e.lastRequestData=t;typeof t.options=="undefined"&&(t.options={});e.pagination.nextPage!=null&&(t.options.nextPage=e.pagination.nextPage);e.pagination.nextPageToken!=null&&(t.options.nextPageToken=e.pagination.nextPageToken);$manager.spinner("on");$manager.getVideosErrorReset();$manager.more("hide");Dukt.postActionRequest("videos/getVideosFromUrl",t,$.proxy(function(t,r){$manager.spinner("off");if(t&&r=="success"&&!t.hasOwnProperty("error")&&typeof t.videos!="undefined"){t.hasOwnProperty("nextPage")&&(e.pagination.nextPage=t.nextPage);t.hasOwnProperty("nextPageToken")&&(e.pagination.nextPageToken=t.nextPageToken);t.hasOwnProperty("more")&&t.more==1&&$manager.more("show");$(".dk-videos",$manager.$container).removeClass("hidden");if(n){e.selectedVideoIndex(null);$(".submit",$manager.$container).addClass("disabled");$(".videos-main .dk-middle",$manager.$container).get(0).scrollTop=0;e.videos(t.videos)}else e.videos(e.videos().concat(t.videos));if(e.videos().length==0){$(".dk-no-videos",$manager.$container).removeClass("hidden");$manager.more("hide")}else $(".dk-no-videos",$manager.$container).addClass("hidden");var i=$(".videos-main .dk-middle",$manager.$container),s=$(".dk-no-videos",i);Dukt.Utils.positionCenter(s,i)}else{!t||typeof t.videos=="undefined"?error="Couldn't get videos.":t.hasOwnProperty("error")&&(error=t.error);if(n)$manager.getVideosError(error);else{$(".dk-videos",$manager.$container).addClass("hidden");$manager.getVideosError(error,!0)}}},this))};e.more=function(){e.getVideos()};e.doSearch=function(t){typeof t!="undefined"&&t&&(e.previousSearchQuery="");if(e.searchQuery=="")e.previousSearchQuery=e.searchQuery;else if(e.previousSearchQuery!=e.searchQuery){e.previousSearchQuery=e.searchQuery;clearTimeout(e.searchTimeout);$manager.spinner("on");e.searchTimeout=setTimeout(function(){var t={url:e.selectedGateway()+"/search",options:{q:e.searchQuery}};e.getVideos(t)},800)}};e.cancel=function(){$manager.close()};e.back=function(){$manager.back()};e.play=function(e){$manager.play(e)};e.submit=function(t,n,r,i){$target=$(n.target);if(!$target.hasClass("disabled")){var s=e.selectedVideoIndex(),o=e.videos(),u=o[s],a=$manager.$field;a.$input.val(u.url);a.lookupVideo();$manager.close()}};e.selectVideo=function(t,n){e.selectedVideoIndex(t);$(".submit",$manager.$container).removeClass("disabled")}};