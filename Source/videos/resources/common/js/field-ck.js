/**
 * VideoField
 */VideoField=Dukt.Base.extend({$input:null,$spinner:null,$preview:null,lookupVideoTimeout:null,init:function(e){this.$input=$("#"+e);this.$container=this.$input.parents(".dkv-video");this.$spinner=$(".dk-spinner",this.$input.parents(".dkv-video"));this.$preview=$(".dkv-preview-inject",this.$input.parents(".dkv-video"));this.addListener(this.$input,"textchange","lookupVideo");var t=this;this.$container.on("click",".dkv-image",function(e){t.playVideo();e.preventDefault()});$(".dk-add, .dk-edit",this.$container).on("click",function(e){$manager.open(t);e.preventDefault()});this.$container.on("click",".dk-remove",function(e){t.$input.val("");t.lookupVideo();e.preventDefault()})},playVideo:function(){$player.play(this.$input.val())},lookupVideo:function(){var e=this.$input.val();if(e){this.$spinner.removeClass("hidden");$(".dk-error",this.$container).addClass("hidden");Dukt.postActionRequest("videos/lookupVideo",{url:e},$.proxy(function(e,t){this.$spinner.addClass("hidden");if(e&&t=="success")if(!e.hasOwnProperty("error")){this.$preview.show();this.$preview.html(e.preview)}else{$(".dk-error",this.$container).html(e.error);$(".dk-error",this.$container).removeClass("hidden");this.$preview.hide()}else this.$preview.hide()},this))}else this.$preview.hide()}});var Player=Modal.extend({init:function(){this.base()},play:function(e){var t={url:e};$.post(Dukt.getUrl("videos/modals/player"),t,$.proxy(function(e,t,n){if(t=="success"){this.$inject.html(e);this.open()}},this))},onBeforeOpen:function(){$("iframe",this.$container).height(this.$container.height())},onBeforeClose:function(){this.$inject.html("")}}),$player=new Player;$(document).ready(function(){typeof Matrix!="undefined"&&Matrix.bind("dukt_videos","display",function(e){var t=$(".dkv-input",this);if(!t.length)return;var n=e.field.id+"["+e.row.id+"]["+e.col.id+"]",r=n.replace(/[^\w\-]+/g,"_");t.attr("id",r);e.videosField=new VideoField(r)})});