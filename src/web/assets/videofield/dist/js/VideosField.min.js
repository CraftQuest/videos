"undefined"==typeof Videos&&(Videos={}),Videos.Field=Garnish.Base.extend({$input:null,$container:null,$spinner:null,$preview:null,$player:null,$playBtn:null,$openExplorerBtn:null,$removeBtn:null,inputId:null,explorer:null,playerModal:null,videoSelectorModal:null,explorerHtml:null,init:function(e){this.inputId=e,this.$input=$("#"+e),this.$container=this.$input.parents(".videos-field"),this.$spinner=$(".spinner",this.$container),this.$preview=$(".preview",this.$container),this.$playBtn=$(".play",this.$container),this.$openExplorerBtn=$(".videos-add",this.$container),this.$removeBtn=$(".delete",this.$container),this.addListener(this.$input,"textchange","fieldPreview"),this.addListener(this.$openExplorerBtn,"click","openExplorer"),this.addListener(this.$playBtn,"click","playVideo"),this.addListener(this.$removeBtn,"click","removeVideo")},removeVideo:function(e){this.$input.val(""),this.fieldPreview(),e.preventDefault()},openExplorer:function(e){if(this.videoSelectorModal)this.videoSelectorModal.show();else{var i;const t=$('<div class="videoselectormodal modal"></div>').appendTo(Garnish.$bod),n=$('<div class="explorer-container"/>').appendTo(t),o=$('<div class="footer"/>').appendTo(t),s=$('<div class="buttons right"/>').appendTo(o),l=$('<div class="btn">'+Craft.t("app","Cancel")+"</div>").appendTo(s),d=$('<input type="submit" class="btn submit disabled" value="'+Craft.t("app","Select")+'" />').appendTo(s);this.videoSelectorModal=new Garnish.Modal(t,{visible:!1,resizable:!1}),this.addListener(l,"click",function(){this.videoSelectorModal.hide()}),this.addListener(d,"click",function(){this.$input.val(i),this.$input.trigger("change"),this.videoSelectorModal.hide()}),this.explorer||(this.explorer=new Videos.Explorer(n,{namespaceInputId:this.inputId,onPlayerHide:$.proxy(function(){this.videoSelectorModal.show()},this),onPlayerShow:$.proxy(function(){this.videoSelectorModal.hide()},this),onSelectVideo:$.proxy(function(e){i=e,d.removeClass("disabled")},this),onDoubleClickVideo:$.proxy(function(e){this.$input.val(e),this.$input.trigger("change"),this.videoSelectorModal.hide()},this),onDeselectVideo:$.proxy(function(){d.addClass("disabled")},this)}),this.videoSelectorModal.updateSizeAndPosition(),Craft.initUiElements())}},playVideo:function(e){const i=$(e.currentTarget).data("gateway"),t=$(e.currentTarget).data("id");this.playerModal?this.playerModal.show():this.playerModal=new Videos.Player,this.playerModal.play({gateway:i,videoId:t})},fieldPreview:function(){const e=this.$input.val();e?(this.$spinner.removeClass("hidden"),$(".error",this.$container).addClass("hidden"),Craft.postActionRequest("videos/explorer/field-preview",{url:e},$.proxy(function(e,i){if(this.$spinner.addClass("hidden"),this.$preview.show(),"success"==i)if(e.error)this.$preview.html('<p class="error">'+e.error+"</p>");else{this.$preview.html(e.preview);const t=$(".play",this.$container),n=$(".delete",this.$container);this.addListener(t,"click","playVideo"),this.addListener(n,"click","removeVideo")}},this))):this.$preview.hide()}}),$(document).ready(function(){"undefined"!=typeof Matrix&&Matrix.bind("dukt_videos","display",function(e){const i=$(".input",this);if(i.length){const t=e.field.id+"["+e.row.id+"]["+e.col.id+"]",n=t.replace(/[^\w\-]+/g,"_");i.attr("id",n),e.videosField=new Videos.Field(n)}})});